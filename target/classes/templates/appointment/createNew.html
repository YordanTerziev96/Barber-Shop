<main>
	<div class="container body-content span=8 offset=2">
		<div class="well">
			<form class="form-horizontal" th:action="@{/create}" method="post">
				<fieldset>
					<legend>Create Appointment</legend>
					<div class="form-group">
						<label class="col-sm-4 control-label" for="date">Date</label>
						<div class="col-sm-4 ">
							<input class="form-control" type="date" id="date"
								placeholder="Date" name="date" required="required"
								onchange="fetchHours(this.value);" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label" for="time">Time</label>
						<div>
							<select class="timeinpt" id="times" name="hour" required="required"
								onmousedown="if(this.options.length>0){this.size=5;}"
								onchange="this.blur()" onblur="this.size=0"></select>
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-4 col-sm-offset-4">
							<a class="btn btn-default" th:href="@{/}">Cancel</a> <input
								value="Submit" type="submit" class="btn btn-primary" />
						</div>
					</div>
				</fieldset>
			</form>
		</div>
	</div>
</main>
<script type="text/javascript">
	function fetchHours(value){
		var mydate = new Date(value);
		var month = mydate.getMonth() + 1;
		if(month<10){
		var newDate = mydate.getDate() + "-0" + month + "-" + mydate.getFullYear();
		}else{
			var newDate = mydate.getDate() + "-" + month + "-" + mydate.getFullYear();
		}
		fetch('http://localhost:8080/appointment/freeAppointments?date='+newDate, {
			method: "GET",
			credentials: "include",
			headers: new Headers({'Content-Type': 'application/json',
	             'Authorization': 'Basic '+ 'dancho:0000'}),
		  	body: console.log("Connecting to back-end")
		}).then(
			function(response) {
		    	if (response.status !== 200) {
		        	console.log('Looks like there was a problem. Status Code: ' +
		            response.status);
		          	return;
			}

		   	// Examine the text in the response
		    response.json().then(function(data) {
		    	var options = '';
		        for (var i = 0; i < data.length; i++)
					options += '<option value="'+data[i]+'">'+data[i]+'</option>';
		        	document.getElementById('times').innerHTML = options;
		        });
		   	}
		)
		.catch(function(err) {
			console.log('Fetch Error :-S', err);
		});
	}
</script>

<style>
	@media ( min-width : 768px) {
		.timeinpt {
			z-index: 999;
			margin-left: 33%;
		}
	}

	@media ( min-width : 1500px) and (max-width: 1875px) {
		.timeinpt {
			z-index: 999;
			margin-left: 17px;
		}
	}
</style>
